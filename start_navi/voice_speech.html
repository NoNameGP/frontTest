<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>출발지 설정 - 1-2</title>
<link rel="stylesheet" type="text/css" id="applicationStylesheet" href="voice_speech.css"/>
<script id="applicationScript" type="text/javascript" src="voice_speech.js"></script>
</head>
<body>
<div id="n__-_1-2">
	<svg class="n_29_dk">
		<radialGradient id="n_29_dk" spreadMethod="pad" x1="0" x2="0" y1="0" y2="0">
			<stop offset="0" stop-color="#363636" stop-opacity="1"></stop>
			<stop offset="1" stop-color="#191919" stop-opacity="1"></stop>
		</radialGradient>
		<ellipse id="n_29_dk" rx="75" ry="75" cx="75" cy="75">
		</ellipse>
	</svg>
	<div id="n_607">
		<svg class="n_1" viewBox="0 0 4 30">
			<path id="n_1" d="M 0 30 L 0 0">
			</path>
		</svg>
		<svg class="n_2" viewBox="0 0 15 25">
			<path id="n_2" d="M 0 25 L 15 0">
			</path>
		</svg>
		<svg class="n_5" viewBox="0 0 30 15">
			<path id="n_5" d="M 0 15 L 30 0">
			</path>
		</svg>
		<svg class="n_6" viewBox="0 0 15 25">
			<path id="n_6" d="M 15 25 L 0 0">
			</path>
		</svg>
		<svg class="n_7" viewBox="0 0 30 15">
			<path id="n_7" d="M 30 15 L 0 0">
			</path>
		</svg>
	</div>
	<div onclick="application.goToTargetView(event)" id="Icon_ionic-ios-arrow-back">
		<svg class="Icon_ionic-ios-arrow-back_ds" viewBox="11.251 6.194 13.503 23.619">
			<path id="Icon_ionic-ios-arrow-back_ds" d="M 15.32109355926514 18 L 24.2578125 9.0703125 C 24.91875076293945 8.409375190734863 24.91875076293945 7.340624809265137 24.2578125 6.686718940734863 C 23.59687423706055 6.025781631469727 22.52812576293945 6.032812595367432 21.8671875 6.686718940734863 L 11.7421875 16.8046875 C 11.10234355926514 17.44453048706055 11.08828163146973 18.47109413146973 11.69296836853027 19.13203048706055 L 21.86015701293945 29.3203125 C 22.19062614440918 29.65078163146973 22.62656402587891 29.8125 23.05546951293945 29.8125 C 23.484375 29.8125 23.92031288146973 29.65078163146973 24.25078201293945 29.3203125 C 24.91172027587891 28.65937423706055 24.91172027587891 27.59062576293945 24.25078201293945 26.93671798706055 L 15.32109355926514 18 Z">
			</path>
		</svg>
	</div>
	<div id="n__1__11" class="______1___11">
		<div id="n_603">
			<div id="n_284">
				<svg class="n_156">
					<rect id="n_156" rx="0" ry="0" x="0" y="0" width="34.362" height="11.796">
					</rect>
				</svg>
				<div id="n_230">
					<span>12:30</span>
				</div>
			</div>
			<div id="sysbar_battery">
				<svg class="n_159">
					<rect id="n_159" rx="0" ry="0" x="0" y="0" width="14" height="12">
					</rect>
				</svg>
				<svg class="n_80" viewBox="42.8 1 7.731 10.321">
					<path id="n_80" d="M 47.95423126220703 1.737242221832275 L 47.95423126220703 1 L 45.37711715698242 1 L 45.37711715698242 1.737242221832275 L 42.80000305175781 1.737242221832275 L 42.80000305175781 11.32139110565186 L 50.53134536743164 11.32139110565186 L 50.53134536743164 1.737242221832275 L 47.95423126220703 1.737242221832275 Z">
					</path>
				</svg>
			</div>
		</div>
		<div id="Icon_feather-wifi">
			<svg class="n_2148" viewBox="7.5 15.003 8.186 1.617">
				<path id="n_2148" d="M 7.5 16.61988639831543 C 9.871232032775879 14.46428489685059 13.31466579437256 14.46428680419922 15.6858959197998 16.61988830566406">
				</path>
			</svg>
			<svg class="n_2149" viewBox="2.13 7.504 13.421 2.536">
				<path id="n_2149" d="M 2.130000114440918 10.04040813446045 C 5.964924335479736 6.658497333526611 11.71561336517334 6.658499240875244 15.55053234100342 10.04041004180908">
				</path>
			</svg>
			<svg class="n_2150" viewBox="12.795 22.502 5.139 0.704">
				<path id="n_2150" d="M 12.79500007629395 23.20541381835938 C 14.33347225189209 22.26737403869629 16.39505386352539 22.26737594604492 17.93352508544922 23.20541572570801">
				</path>
			</svg>
			<svg class="n_2151" viewBox="18 30 2 2">
				<path id="n_2151" d="M 18 30 L 18 30">
				</path>
			</svg>
		</div>
		<div id="n_615">
			<svg class="n_8" viewBox="0 0 2 0.858">
				<path id="n_8" d="M 0 0.8582178950309753 L 0 0">
				</path>
			</svg>
			<svg class="n_9" viewBox="0 0 2 8.973">
				<path id="n_9" d="M 0 8.973363876342773 L 0 0">
				</path>
			</svg>
			<svg class="n_10" viewBox="0 0 2 3.433">
				<path id="n_10" d="M 0 3.432871580123901 L 0 0">
				</path>
			</svg>
			<svg class="n_11" viewBox="0 0 2 6.399">
				<path id="n_11" d="M 0 6.398709774017334 L 0 0">
				</path>
			</svg>
		</div>
	</div>
	<div id="Text">
		<span>음성인식</span>
	</div>
	<!-- <svg class="n_1_ec">
		<ellipse id="n_1_ec" rx="7" ry="7" cx="7" cy="7">
		</ellipse>
	</svg>
	<svg class="n_2_ed">
		<ellipse id="n_2_ed" rx="7" ry="7" cx="7" cy="7">
		</ellipse>
	</svg>
	<svg class="n_15">
		<ellipse id="n_15" rx="7" ry="7" cx="7" cy="7">
		</ellipse>
	</svg> -->
	<svg class="pulse" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<circle id="Oval" cx="512" cy="512" r="700"></circle>
		<circle id="Oval" cx="512" cy="512" r="500"></circle>
		<!-- <circle id="Oval" cx="512" cy="512" r="300"></circle> -->
	</svg>

	<svg class="Icon_awesome-microphone-alt" viewBox="0 0 77.736 113.071">
		<path id="Icon_awesome-microphone-alt" d="M 74.20293426513672 42.40167617797852 L 70.66945648193359 42.40167617797852 C 68.71721649169922 42.40167617797852 67.135986328125 43.98290252685547 67.135986328125 45.93515014648438 L 67.135986328125 56.53556823730469 C 67.135986328125 73.05455017089844 52.89388275146484 86.30949401855469 36.04363250732422 84.66642761230469 C 21.35763549804688 83.23316192626953 10.60041904449463 70.03122711181641 10.60041904449463 55.27676773071289 L 10.60041904449463 45.93515014648438 C 10.60041904449463 43.98290252685547 9.019189834594727 42.40167617797852 7.066946029663086 42.40167617797852 L 3.533473014831543 42.40167617797852 C 1.581229209899902 42.40167617797852 0 43.98290252685547 0 45.93515014648438 L 0 54.80416488647461 C 0 74.60044860839844 14.12726593017578 92.24793243408203 33.5679931640625 94.928955078125 L 33.5679931640625 102.4707183837891 L 21.20083808898926 102.4707183837891 C 19.24859428405762 102.4707183837891 17.6673641204834 104.0519409179688 17.6673641204834 106.0041885375977 L 17.6673641204834 109.5376586914062 C 17.6673641204834 111.4899063110352 19.24859428405762 113.0711364746094 21.20083808898926 113.0711364746094 L 56.53556823730469 113.0711364746094 C 58.48781204223633 113.0711364746094 60.06903839111328 111.4899063110352 60.06903839111328 109.5376586914062 L 60.06903839111328 106.0041885375977 C 60.06903839111328 104.0519409179688 58.48781204223633 102.4707183837891 56.53556823730469 102.4707183837891 L 44.16841125488281 102.4707183837891 L 44.16841125488281 95.01287841796875 C 63.09678268432617 92.41577911376953 77.73640441894531 76.16842651367188 77.73640441894531 56.53556823730469 L 77.73640441894531 45.93515014648438 C 77.73640441894531 43.98290252685547 76.15517425537109 42.40167617797852 74.20293426513672 42.40167617797852 Z M 38.86820220947266 77.73640441894531 C 50.57724761962891 77.73640441894531 60.06903839111328 68.24461364746094 60.06903839111328 56.53556823730469 L 41.22458648681641 56.53556823730469 C 39.923828125 56.53556823730469 38.86820220947266 55.74495315551758 38.86820220947266 54.76882934570312 L 38.86820220947266 51.23535919189453 C 38.86820220947266 50.25923538208008 39.923828125 49.46862030029297 41.22458648681641 49.46862030029297 L 60.06903839111328 49.46862030029297 L 60.06903839111328 42.40167617797852 L 41.22458648681641 42.40167617797852 C 39.923828125 42.40167617797852 38.86820220947266 41.61106109619141 38.86820220947266 40.63493728637695 L 38.86820220947266 37.10146713256836 C 38.86820220947266 36.12534332275391 39.923828125 35.3347282409668 41.22458648681641 35.3347282409668 L 60.06903839111328 35.3347282409668 L 60.06903839111328 28.26778411865234 L 41.22458648681641 28.26778411865234 C 39.923828125 28.26778411865234 38.86820220947266 27.47716903686523 38.86820220947266 26.50104713439941 L 38.86820220947266 22.96757507324219 C 38.86820220947266 21.99145126342773 39.923828125 21.20083808898926 41.22458648681641 21.20083808898926 L 60.06903839111328 21.20083808898926 C 60.06903839111328 9.491791725158691 50.57724761962891 0 38.86820220947266 0 C 27.15915870666504 0 17.6673641204834 9.491791725158691 17.6673641204834 21.20083808898926 L 17.6673641204834 56.53556823730469 C 17.6673641204834 68.24461364746094 27.15915870666504 77.73640441894531 38.86820220947266 77.73640441894531 Z">
		</path>
	</svg>

	<!-- <div class="container">		 -->
		
	<!-- </div> -->

</div>

<div style="opacity: 0;" class="words" contenteditable>
</div>

<script>
	navigator.mediaDevices.getUserMedia({ audio: true })
	  .then(function(stream) {
		console.log('마이크 액세스 권한이 허용되었습니다.');
		// 추가적인 처리 로직을 작성할 수 있습니다.
	  })
	  .catch(function(error) {
		console.error('마이크 액세스 권한을 얻을 수 없습니다:', error);
		// 오류 처리 로직을 작성할 수 있습니다.
	  });
	</script>
	
<script>

	


	var speech_word;
	// Google Chrome and Microsoft Edge need vendor prefix 'webkit'
	window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

	const recognition = new SpeechRecognition();

	// 음성인식 도중의 결과 반환
	// false는 첫 단어만 반환, true는 문장으로 반환
	recognition.interimResults = true;

	// 값이 없으면 HTML의 <html lang="en">을 참고합니다. ko-KR, en-US
	recognition.lang = "ko-KR";

	// true면 음성 인식이 안 끝나고 계속 됩니다. 중간에 stop이 안됨. stop하려면 강제 호툴이 필요.
	recognition.continuous = true;

	// 숫자가 작을수록 발음대로 적고, 크면 문장의 적합도에 따라 알맞은 단어로 대체합니다.
	// maxAlternatives가 크면 이상한 단어도 문장에 적합하게 알아서 수정합니다.
	recognition.maxAlternatives = 20000;

	// HTML element for recognition results
	let p = document.createElement('p');
	const words = document.querySelector('.words');
	words.appendChild(p); // .words가 정의된 div내에 새로운 p 문단들을 넣어줄 예정입니다.

	// it listens when the result comes back
	recognition.addEventListener('result', e => {
		const transcript = Array.from(e.results)
		.map(result => result[0])
		.map(result => result.transcript)
		.join('');

		p.textContent = transcript;
		speech_word = p.textContent;

	  // create new paragraph when speech breaks
	  // 잠시 멈췄다 말할 때 덮어씌워지는 문제 해결하기 위해 새로운 내용을 넣을 새 문단 요소 만들기
	  // if(e.results[0].isFinal) {
	  //   p = document.createElement('p');
	  //   words.appendChild(p);
	  // }

	  // recognize certain speech
		// can be used with external Weather API
		// 특정 단어를 인식하면 함수를 수행하는 방식
	//   if(transcript.includes('온도')) {
	// 	console.log(`오늘의 온도는 00도입니다.`);
	//   }

		console.log(p.textContent);
	})

	// 음성 인식은 말이 끝나는 순간 작동을 멈춘다. 그래서 말하던 중 잠시 멈췄다 말하더라도 계속 인식하게
	// recognition unbinds itself when result comes back, making it unavailable
	// restart is needed when recognition ends
	// recognition.addEventListener('end', () => {
	//   recognition.start();
	// });

	recognition.start(); //음성인식 시작

	//음성인식 종료 제어
	// recognition.onend = function() {
	//   console.log('한 뭉탱이 인식이 끝났습니다.');
	//   recognition.stop();
	// };
	
	recognition.onspeechend = function() { // 음성 감지가 끝날때 실행될 이벤트
		recognition.stop();
		console.log('인식이 끝났습니다.');
	}

</script>

<script>
	function locateKap(){
		localStorage.setItem("start_speech_word", speech_word);
		console.log("페이지 이동완료");
		location.replace("voice_speech_list.html");
	}

	cnt = 5; //10초 카운트
	function countdown(){
		if(cnt == 0){
			locateKap();
		}else{
			setTimeout("countdown()", 1000);
			console.log(cnt);
			cnt--;
		}
	}

	countdown();
</script>

</body>
</html>